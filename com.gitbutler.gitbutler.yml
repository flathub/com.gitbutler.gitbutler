id: com.gitbutler.gitbutler
runtime: org.gnome.Platform
runtime-version: '49'
sdk: org.gnome.Sdk
command: gitbutler-tauri
rename-desktop-file: GitButler.desktop
rename-icon: gitbutler-tauri

finish-args:
  - --share=ipc
  - --socket=fallback-x11
  - --socket=wayland
  - --device=dri
  - --share=network
  - --filesystem=~/.ssh:ro
  - --filesystem=xdg-run/gvfsd
  - --talk-name=org.freedesktop.secrets

modules:
  - name: git
    cleanup:
      - /share
    make-args:
      - NO_PERL=1
      - NO_TCLTK=1
    make-install-args:
      - INSTALL_SYMLINKS=1
      - NO_PERL=1
      - NO_TCLTK=1
    sources:
      - type: archive
        url: https://www.kernel.org/pub/software/scm/git/git-2.52.0.tar.gz
        sha256: 6880cb1e737e26f81cf7db9957ab2b5bb2aa1490d87619480b860816e0c10c32
        x-checker-data:
          type: anitya
          project-id: 5350
          url-template: https://www.kernel.org/pub/software/scm/git/git-$version.tar.gz

  - name: gitbutler
    buildsystem: simple
    build-commands:
      - ar x GitButler.deb
      - tar xf data.tar.gz
      - mv usr/bin/* /app/bin
      - mv usr/share/* /app/share
      - install -Dm644 -t /app/share/metainfo com.gitbutler.gitbutler.metainfo.xml
    sources:
      - type: file
        only-arches: [x86_64]
        url: https://releases.gitbutler.com/releases/release/0.18.0-2626/linux/x86_64/GitButler_0.18.0_amd64.deb
        sha256: 74bbd378a5eda175d1c1cd2f111d905857af39d43ef5ffcf0c600814011087b6
        dest-filename: GitButler.deb
        x-checker-data:
          type: json
          url: https://app.gitbutler.com/releases
          version-query: .version
          timestamp-query: .pub_date
          url-query: .platforms."linux-x86_64".url | sub(".AppImage.tar.gz"; ".deb")
      - type: file
        path: com.gitbutler.gitbutler.metainfo.xml
